<!DOCTYPE html>
<html class="no-js" lang="de-AT">


<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-63326882-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-63326882-1');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> Tetris </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="generator" content="Hugo 0.73.0" /> <!-- Fonts -->

    

    

    

    

    

    
    <link rel="canonical" href="https://linz.coderdojo.net/uebungsanleitungen/programmieren/web/tetris/" />
    

    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,500,600,700,800' rel='stylesheet'
        type='text/css'>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet"> <!-- Stylesheets -->
     
    
    <link rel="stylesheet" href="https://linz.coderdojo.net/vendor.min.55a3cbb6f035c25e5c7cf706ee053eca6f5a54d8095b05fd737d1b0330f99eaf.css">
    <link rel="stylesheet" href="https://linz.coderdojo.net/css/animate.css">
     
     
    <link rel="stylesheet" href="https://linz.coderdojo.net/style.min.7a53520a336aec20f959240c4427553696fd444f3e3d659194dcb03955e9a9c0.css">
    <script src="https://kit.fontawesome.com/5bb5b2cc9c.js" crossorigin="anonymous"></script>
</head>

<body id="body">
    <!-- NAVIGATION -->

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light ">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"><img src="/img/logo-linz.png" height="30"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item ">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/termine">Termine</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/info">Infos</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/mentoren">Mentoren</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/sponsoring">Sponsoring</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/uebungsanleitungen">√úbungsanleitungen</a>
                </li>
            </ul>
        </div>
    </div>
</nav>  
     
     

<div class="container-fluid breadcrumb-container">
    <div class="container">
        <nav class="breadcrumb-nav" aria-label="breadcrumb">
        <ol class="breadcrumb">
            
        
        
        
        
        
        
        
        
        

        
        
        

        
        
        <li class="breadcrumb-item">
            <a href="https://linz.coderdojo.net/uebungsanleitungen/">√úbungsanleitungen</a>
        </li>
        
        
        
        

        
        
        <li class="breadcrumb-item">
            <a href="https://linz.coderdojo.net/uebungsanleitungen/programmieren/">Programmieren</a>
        </li>
        
        
        
        

        
        
        <li class="breadcrumb-item">
            <a href="https://linz.coderdojo.net/uebungsanleitungen/programmieren/web/">Web</a>
        </li>
        
        
        
        

        
        
        
        
        </ol>

        
        </nav>
    </div>
</div> 

<section id="sushi">
    <div class="container">
        <div class="row">
            
            <div class="col-12 sushi-toc">
                <h2>Inhalt</h2>
                <nav id="TableOfContents">
<ul>
<li><a href="#tetris">Tetris</a>
<ul>
<li><a href="#project-setup-and-file-linking">Project setup and file linking</a></li>
<li><a href="#set-up-the-grid-for-our-tetris-game">Set up the Grid for our Tetris game</a></li>
<li><a href="#display-a-random-tetromino-on-the-top">Display a random Tetromino on the top.</a></li>
<li><a href="#implement-moving-left-and-right-with-the-arrow-keys">Implement moving left and right with the arrow keys</a></li>
<li><a href="#implement-rotating-with-the-arrow-up-key">Implement rotating with the arrow up key</a></li>
<li><a href="#implement-moving-down-with-the-arrow-down-key">Implement moving down with the arrow down key</a></li>
<li><a href="#freezing-tetrominos-when-they-touch-another-tetromino">Freezing tetrominos when they touch another tetromino</a></li>
<li><a href="#tetrominos-move-down-on-their-own">Tetrominos move down on their own</a></li>
<li><a href="#full-rows-vanish-and-add-to-the-score">Full rows vanish and add to the score</a></li>
<li><a href="#game-over">Game Over</a></li>
</ul></li>
</ul>
</nav>
            </div>
            <div class="col-12 sushi-content"> 

<h1 id="tetris">Tetris</h1>

<p>In this session we will impelment a version of the TETRIS game based on a video by the amazin Ania Kub√≥w. Check out her youtube channel <a href="https://www.youtube.com/channel/UC5DNytAJ6_FISueUfzZCVsw" target="_blank"> &ndash;&gt; here &lt;&ndash; </a>.</p>

<h2 id="project-setup-and-file-linking">Project setup and file linking</h2>

<p>We will need three files - a index.html that contains the markup of our website, an app.js file that contains our logic and a styles.css for styling.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#00f">&lt;!DOCTYPE html&gt;</span>
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=<span style="color:#a31515">&#34;utf-8&#34;</span>&gt;
        &lt;script src=<span style="color:#a31515">&#34;app.js&#34;</span>&gt;&lt;/script&gt;
        &lt;link rel=<span style="color:#a31515">&#34;stylesheet&#34;</span> type=<span style="color:#a31515">&#34;text/css&#34;</span> href=<span style="color:#a31515">&#34;styles.css&#34;</span>/&gt;
        &lt;title&gt;Tetris&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;

    &lt;/body&gt;
&lt;/html&gt;</code></pre></div>
<p>In order to verify that our linking works out properly we put an <code>alert('Hello Tetris')</code> to the app.js file and a <code>body { background: hotpink; }</code> to the styles.css file.
We should now see a popup containing the text &ldquo;Hello Tetris&rdquo; when we reload the page and the pages background should have a specified color.</p>

<h2 id="set-up-the-grid-for-our-tetris-game">Set up the Grid for our Tetris game</h2>

<p>The main thing we need in our game is our game grid - We will start with a game are with a width of 10 and a height of 20. Therefore we need 200 cells.
A cell will be represented by a div tag.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#00f">&lt;!DOCTYPE html&gt;</span>
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=<span style="color:#a31515">&#34;utf-8&#34;</span>&gt;
        &lt;script src=<span style="color:#a31515">&#34;app.js&#34;</span>&gt;&lt;/script&gt;
        &lt;link rel=<span style="color:#a31515">&#34;stylesheet&#34;</span> type=<span style="color:#a31515">&#34;text/css&#34;</span> href=<span style="color:#a31515">&#34;styles.css&#34;</span>/&gt;
        &lt;title&gt;Tetris&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class=<span style="color:#a31515">&#34;grid&#34;</span>&gt;
            &lt;div class=<span style="color:#a31515">&#34;cell&#34;</span>&gt;&lt;/div&gt;
            ...
            &lt;div class=<span style="color:#a31515">&#34;cell&#34;</span>&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre></div>
<p>Next up we will define the size of our grid and make it visibile by applying some background colors. We want every cell to have a size of 20 x 20 pixels therefor our whole grid will have a width of 10 * 20 = 200 and a height of 20 * 20 = 400 pixels. We will also set up some styling for our cells so we see their placement.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">.<span style="color:#2b91af">grid</span> {
    <span style="color:#00f">height</span>: 400<span style="color:#2b91af">px</span>; 
    <span style="color:#00f">width</span>: 200<span style="color:#2b91af">px</span>;
    <span style="color:#00f">background</span>: <span style="color:#00f">lightblue</span>;
}

.<span style="color:#2b91af">cell</span> {
    <span style="color:#00f">border</span>: <span style="color:#00f">solid</span> <span style="color:#00f">lightgray</span> 1<span style="color:#2b91af">px</span>;
    <span style="color:#00f">height</span>: 18<span style="color:#2b91af">px</span>;
    <span style="color:#00f">width</span>: 18<span style="color:#2b91af">px</span>;
}</code></pre></div>
<p>When we refresh our page now, we will see that our cells actually fall out of our grid. In order to correct that we will use flex-wrap on the grid, which tells the child elements to wrap if necessary (instead of overflowing like we&rsquo;ve seen before).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">.<span style="color:#2b91af">grid</span> {
    <span style="color:#00f">display</span>: <span style="color:#00f">flex</span>;
    <span style="color:#00f">flex-wrap</span>: <span style="color:#00f">wrap</span>;
}</code></pre></div>
<p>Now we should end up with a grid that resembles this structure:</p>
<pre><code>00 01 02 03 04 05 06 07 08 09
10 11 12 13 14 15 16 17 18 19
20 21 22 23 24 25 26 27 28 29
...
190 191 192 193 194 195 196 197 198 199</code></pre>
<h2 id="display-a-random-tetromino-on-the-top">Display a random Tetromino on the top.</h2>

<p>There are five different tetrominos and in order to choose randomly from them we&rsquo;ll need to define each tetromino. We will define each tetromino as an array of their possible rotations inside a 4x4 field.</p>

<p>An lTetromino(L) can have the following displays:</p>
<pre><code>  0 1 2 3
0   # #
1   # 
2   #
3

  0 1 2 3
0
1 # # #
2     #    
3   

  0 1 2 3
0   #
1   # 
2 # # 
3

  0 1 2 3
0
1 #
2 # # #
3   </code></pre>
<p>which corresponds to</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">const</span> lTetromino = [
    [1, width+1, width*2+1, 2], 
    [width, width+1, width+2, width*2+2], 
    [1, width+1, width*2+1, width*2], 
    [width, width*2, width*2+1, width*2+2]
];
</code></pre></div>
<p>We&rsquo;ll do the exact same thing for all five of our tetrominos and put the five tetrominos in one array to choose randomly from.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">const</span> width = 10;
<span style="color:#00f">const</span> height = 20;

<span style="color:#00f">const</span> lTetromino = [
    [1, width+1, width*2+1, 2], 
    [width, width+1, width+2, width*2+2], 
    [1, width+1, width*2+1, width*2], 
    [width, width*2, width*2+1, width*2+2]
];
<span style="color:#00f">const</span> zTetromino = [
    [0, width, width+1, width*2+1], 
    [width+1, width+2, width*2, width*2 +1], 
    [0, width, width+1, width*2+1], 
    [width+1, width+2, width*2, width*2 +1]
];
<span style="color:#00f">const</span> tTetromino = [
    [1, width, width+1, width+2], 
    [1, width+1, width+2, width*2+1], 
    [width, width+1, width+2, width*2+1], 
    [1, width, width+1, width*2+1]
];
<span style="color:#00f">const</span> iTetromino = [
    [1, width+1, width*2+1, width*3+1], 
    [width, width+1, width+2, width+3], 
    [1, width+1, width*2+1, width*3+1], 
    [width, width+1, width+2, width+3]
];
<span style="color:#00f">const</span> oTetromino = [
    [0, width, 1, width+1], 
    [0, width, 1, width+1], 
    [0, width, 1, width+1], 
    [0, width, 1, width+1]
];

<span style="color:#00f">const</span> allTetrominos = [lTetromino, zTetromino, tTetromino, iTetromino, oTetromino];
</code></pre></div>
<p>Next we will write a function to display our tetromino on the grid, we will do this by applying a css class to the cells that our tetromino is covering. First we will add some styling to all elements that have a <code>class=&quot;falling-tetromino&quot;</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">.<span style="color:#2b91af">falling-tetromino</span> {
    <span style="color:#00f">background</span>: <span style="color:#00f">hotpink</span>;
}</code></pre></div>
<p>Now we need to implement a draw and undraw function for our tetromino - the function will draw a tetromino, which is an array of numbers that tells us which cells to color repectively to our current position at a specific position. <code>currentTetromino</code> and <code>currentPosition</code> are global variables, we will need to modify and read them across functions.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">let</span> cells = Array.from(document.querySelectorAll(<span style="color:#a31515">&#39;.grid div&#39;</span>))
<span style="color:#00f">let</span> currentTetromino = allTetrominos[0][0];
<span style="color:#00f">let</span> currentPosition = 4;

<span style="color:#00f">function</span> draw() {
    currentTetromino.forEach(drawingOffset =&gt; {
        cells[currentPosition + drawingOffset].classList.add(<span style="color:#a31515">&#39;falling-tetromino&#39;</span>);
    });
}

<span style="color:#00f">function</span> undraw() {
    currentTetromino.forEach(drawingOffset =&gt; {
        cells[currentPosition + drawingOffset].classList.remove(<span style="color:#a31515">&#39;falling-tetromino&#39;</span>);
    });
}
</code></pre></div>
<p>In order to test it we will just use a <code>draw();</code> at the end of our code and set <code>currentTetromino</code> to  <code>allTetrominos[0][0]</code> and currentPosition to <code>4</code> which is the center of the top row of our grid. Now if we reload the page - we might see no tetrominio displayed and see an error in our console instead.</p>

<p>‚ö†Ô∏è That&rsquo;s because we try to load all cells with <code>document.querySelectorAll('.grid div')</code> before the HTML is built actually and then this selector returns nothing.
In order to fix that we will wrap our code in a event listener that listens on the document ready - this event will be fired once the full HTML has been rendered initially.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">document.addEventListener(<span style="color:#a31515">&#39;DOMContentLoaded&#39;</span>, () =&gt; {
   <span style="color:#008000">// all of our existing code
</span><span style="color:#008000"></span>});
</code></pre></div>
<h2 id="implement-moving-left-and-right-with-the-arrow-keys">Implement moving left and right with the arrow keys</h2>

<p>Next we will implement our moveLeft and moveRight functions so that we can move our tetromino to the left and right when we press those arrow keys:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> moveLeft() {
    undraw();
    currentPosition -= 1; 
    draw();
}

<span style="color:#00f">function</span> moveRight() {
    undraw();
    currentPosition += 1; 
    draw();
}
</code></pre></div>
<p>By adding an event listener to the keydown event we can specify a function that will always be called when any key on the keyboard is pressed. This event has a property <code>keyCode</code> which we can use to only react on certain key presses.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">document.addEventListener(<span style="color:#a31515">&#39;keydown&#39;</span>, <span style="color:#00f">function</span> keyDownListener(e) {
    <span style="color:#00f">if</span> (e.keyCode ===39) { <span style="color:#008000">// arrow right
</span><span style="color:#008000"></span>        moveRight();
    } <span style="color:#00f">else</span> <span style="color:#00f">if</span> (e.keyCode === 37) { <span style="color:#008000">// arrow left
</span><span style="color:#008000"></span>        moveLeft();
    }
});
</code></pre></div>
<p>Now we can already properly move to the left and to the right but we can move outside of our grid and cause an error in our program, so we need to add a check in the moveLeft/moveRight function to only if move if we are not yet touching the edge.</p>

<p>We can easily identify if one of our displayed elements touches the left side by calculating the aboslute positions and using the modolo function.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> touchingRightEdge() {
    <span style="color:#00f">return</span> currentTetromino.some(offset =&gt; (currentPosition + offset) % width === width - 1);
}

<span style="color:#00f">function</span> moveRight() {
    <span style="color:#00f">if</span> (!touchingRightEdge()) {
        <span style="color:#008000">// undraw, modify currentPosition, draw
</span><span style="color:#008000"></span>    }
}

<span style="color:#00f">function</span> touchingLeftEdge() {
    <span style="color:#00f">return</span> currentTetromino.some(offset =&gt; (currentPosition + offset) % width === 0);
}

<span style="color:#00f">function</span> moveLeft() {
    <span style="color:#00f">if</span> (!touchingLeftEdge()) {
        <span style="color:#008000">// undraw, modify currentPosition, draw
</span><span style="color:#008000"></span>    }
}
</code></pre></div>
<p>üí° <code>some</code> is a function on an array or list that evaluates a given condition for every element in the array or list. If the condition resolves to true for any (or some ;)) of the elements it will return <code>true</code>.</p>

<h2 id="implement-rotating-with-the-arrow-up-key">Implement rotating with the arrow up key</h2>

<p>When we press the arrow up key we would like to rotate our tetromino. In order to do so we will extract variables for the currentTetrominoIdx and the currentRotationIdx and modify the rotationIdx and currentTetromino variable in the rotate function. Moreover we will add another if statement to our keydown event listener.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> rotate() {
    undraw()
    currentRotationIdx = (currentRotationIdx + 1) % 4
    currentTetromino = allTetrominos[currentTetrominoIdx][currentRotationIdx]
    draw()
}

document.addEventListener(<span style="color:#a31515">&#39;keydown&#39;</span>, <span style="color:#00f">function</span> keyDownListener(e) {
    <span style="color:#008000">// left and right arrow handling
</span><span style="color:#008000"></span>    } <span style="color:#00f">else</span> <span style="color:#00f">if</span> (e.keyCode === 38) { <span style="color:#008000">// arrow up
</span><span style="color:#008000"></span>        rotate();
    }
});
</code></pre></div>
<p>Now when we press the arrow up key we can rotate our tetromino - great!</p>

<h2 id="implement-moving-down-with-the-arrow-down-key">Implement moving down with the arrow down key</h2>

<p>In tetris the tetrominos fall downward over time (we will implement that soon ;)) but you can also speed that process up by clicking the down arrow. That&rsquo;s what we will implement next.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> moveDown() {
    undraw()
    currentPosition += width
    draw()
}

document.addEventListener(<span style="color:#a31515">&#39;keydown&#39;</span>, <span style="color:#00f">function</span> keyDownListener(e) {
    <span style="color:#008000">// left, right and up arrow handling
</span><span style="color:#008000"></span>    } <span style="color:#00f">else</span> <span style="color:#00f">if</span> (e.keyCode === 40) { <span style="color:#008000">// arrow down
</span><span style="color:#008000"></span>        moveDown();
    }
});
</code></pre></div>
<p>Now we have the same problem as we had before when we implemented the left and right movement. When we are at the bottom of our field we get an error. What should actually happen is that the block freezes and stays at the bottom.</p>

<p>We reach the last row if any of our absolute positions from our current tetromino is greater than 190. When we reach it we will mark our current tetromino cells as <code>frozen-tetromino</code> for later usage and start a new tetromino at the top of our grid.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> moveDown() {
    <span style="color:#008000">// undraw, modify currentPosition, draw
</span><span style="color:#008000"></span>    freeze();
}

<span style="color:#00f">function</span> freeze() {
    <span style="color:#00f">if</span> (touchingBottom()) {
        currentTetromino.forEach(offset =&gt; cells[currentPosition + offset].classList.add(<span style="color:#a31515">&#39;frozen-tetromino&#39;</span>));
        setupRandomTetromino();
    }
}

<span style="color:#00f">function</span> setupRandomTetromino() {
    currentTetrominoIdx = Math.floor(Math.random() * allTetrominos.length)
    currentRotationIdx = Math.floor(Math.random() * allTetrominos[currentTetrominoIdx].length)
    currentTetromino = allTetrominos[currentTetrominoIdx][currentRotationIdx];
    currentPosition = 4;
    draw();
}
</code></pre></div>
<p>Perfect! Now tetrominos get stuck at the bottom and new ones appear at the top. But for now they can still fall through other tetrominos. We will fix this next - we will make tetrominos get stuck when they touch another tetromino.</p>

<h2 id="freezing-tetrominos-when-they-touch-another-tetromino">Freezing tetrominos when they touch another tetromino</h2>

<p>This is where our <code>frozen-tetromino</code> class comes into play. We will add a function to check if any cell of our current tetrominos would touch an existing frozen tetromino at its new index.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> wouldTouchFrozenTetromino(potentialPosition) {
    <span style="color:#00f">return</span> currentTetromino.some(offset =&gt; cells[potentialPosition + offset].classList.contains(<span style="color:#a31515">&#39;frozen-tetromino&#39;</span>));
}
</code></pre></div>
<p>We need to call this function in our freeze method, to check if we would touch a frozen tetromino, if we were on row below.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> freeze() {
    <span style="color:#00f">if</span> (touchingBottom() || wouldTouchFrozenTetromino(currentPosition + width)) {
        <span style="color:#008000">// as before
</span><span style="color:#008000"></span>    }
}
</code></pre></div>
<p>We should also check in our moveLeft and moveRight function if no frozen tetrominos are in our way.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> moveRight() {
    <span style="color:#00f">if</span> (!touchingRightEdge() &amp;&amp; !wouldTouchFrozenTetromino(currentPosition + 1)) {
        <span style="color:#008000">// as before
</span><span style="color:#008000"></span>    }
}

<span style="color:#00f">function</span> moveLeft() {
    <span style="color:#00f">if</span> (!touchingLeftEdge() &amp;&amp; !wouldTouchFrozenTetromino(currentPosition - 1)) {
        <span style="color:#008000">// as before
</span><span style="color:#008000"></span>    }
}
</code></pre></div>
<h2 id="tetrominos-move-down-on-their-own">Tetrominos move down on their own</h2>

<p>Next up we will let the tetrominos move down on their own as soon as we click a start button. For that we will add a start button and a score field to our HTML above the grid.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">    &lt;button class=<span style="color:#a31515">&#34;start-button&#34;</span>&gt;Start&lt;/button&gt;
    &lt;h1&gt;Score: &lt;span class=<span style="color:#a31515">&#34;score&#34;</span>&gt;0&lt;/span&gt;&lt;/h1&gt;</code></pre></div>
<p>In our JavaScript file we will add an on-click listener to the start button and call the setupTetromino logic from there to randomly select a tetromino. We can now also remove our hardcoded tetromnio from the beginning (the draw call).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">let</span> timerId = <span style="color:#00f">null</span>;
document.querySelector(<span style="color:#a31515">&#39;.start-button&#39;</span>).addEventListener(<span style="color:#a31515">&#39;click&#39;</span>, () =&gt; {
    setupRandomTetromino();
    timerId = setInterval(moveDown, 1000);
});
</code></pre></div>
<p>üí° With setInterval we can create a recurring event that will happen with an interval of the given number inbetween any two calls. It returns us its unique ID and we will keep it so that we can stop this recurring action in the game over logic.</p>

<h2 id="full-rows-vanish-and-add-to-the-score">Full rows vanish and add to the score</h2>

<p>Great now we can already play the game and it behaves a lot like the original game, but full rows don&rsquo;t vanish yet.
Whenever all cells in one row have the <code>frozen-tetromino</code> class we need to cut out that row, and add it on top of the array again (top of the grid).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> recalculateScore() {
    <span style="color:#00f">for</span> (currentIndex = 0; currentIndex &lt; 200; currentIndex += width) {
        <span style="color:#00f">const</span> row = [currentIndex, currentIndex + 1, currentIndex + 2, currentIndex + 3, currentIndex + 4, currentIndex + 5, currentIndex + 6, currentIndex + 7, currentIndex + 8, currentIndex + 9]
        <span style="color:#00f">if</span> (row.every(index =&gt; cells[index].classList.contains(<span style="color:#a31515">&#39;frozen-tetromino&#39;</span>))) {
            <span style="color:#00f">const</span> cellsRemoved = cells.splice(currentIndex, width)
            cells = cellsRemoved.concat(cells)
            cells.forEach(cell =&gt; document.querySelector(<span style="color:#a31515">&#39;.grid&#39;</span>).appendChild(cell)           
        }
    }
}
</code></pre></div>
<p>By increasing our <code>currentIndex</code> by <code>width</code> (<code>currentIndex += width</code>) in every iteration of our loop we go through our loop 20 times, as we have 20 rows. In each iteration we will save the indices of the current row in a <code>row</code> variable. The row always contains 10 values - [0, 1, 2 &hellip; 8, 9] in the first row, [10, 11, 12 .. 18, 19] in the second row and so on until [190, 191, 192, .. 198, 199] in the last row.</p>

<p>üí° <code>every</code> is a function on an array or list that evaluates a given condition for every element in the array or list, like <code>some</code>. In comparision to <code>some</code> it will only return <code>true</code> if the condition is true for each element in the list or array. If a single element results in the condition evaluating to <code>false</code> the result of the <code>every</code> call will be false.</p>

<p>üí° <code>splice</code> is a method on an array that cuts out n elements on a specific index and returns a list of those elements.</p>

<p>We add a call to this function in our <code>moveDown()</code> function.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> moveDown() {
    <span style="color:#008000">// previous logic
</span><span style="color:#008000"></span>    recalculateScore();
}
</code></pre></div>
<p>Now when we are able to create a full row that row will vanish and the row will appear at the top of the grid again - with the frozen-tetromino class styling so still in pink, we need to remove this styling before we move the row to the top</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">if</span> (row.every(index =&gt; cells[index].classList.contains(<span style="color:#a31515">&#39;frozen-tetromino&#39;</span>))) {
    row.forEach(
        cellIndex =&gt; {
            cells[cellIndex].classList.remove(<span style="color:#a31515">&#39;frozen-tetromino&#39;</span>);
            cells[cellIndex].classList.remove(<span style="color:#a31515">&#39;falling-tetromino&#39;</span>);
        }
    )

    <span style="color:#00f">const</span> cellsRemoved = cells.splice(currentIndex, width)
    <span style="color:#008000">// add cells on top ...
</span><span style="color:#008000"></span>}
</code></pre></div>
<p>Now the moving of the cells to the top should work properly. One thing that&rsquo;s still left is adding to the score and displaying it.
We can easily do that by increasing the score by 10 whenever a row is full (because a row consists of 10 blocks) and updating our dedicated HTML element.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">if</span> (row.every(index =&gt; cells[index].classList.contains(<span style="color:#a31515">&#39;frozen-tetromino&#39;</span>))) {
    score += 10;
    document.querySelector(<span style="color:#a31515">&#39;.score&#39;</span>).innerHTML = score;
    <span style="color:#008000">// splice array and move cells to top ...
</span><span style="color:#008000"></span>}
</code></pre></div>
<h2 id="game-over">Game Over</h2>

<p>Whenever we start a new tetromino and on any of its positions there is already a tetromino, that means we have lost.
So we need to check if we are touching any frozen tetromino on our current position whenever we create a new random tetromino.
When we have lost we will just show a pop up that tells us that we have lost and clear the interval to prevent the tetrominos from falling down further.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">function</span> setupRandomTetromino() {
    <span style="color:#008000">// set up of tetrominos
</span><span style="color:#008000"></span>    <span style="color:#00f">if</span> (wouldTouchFrozenTetromino(currentPosition)) {
        alert(<span style="color:#a31515">&#39;Game Over!&#39;</span>);
        clearInterval(timerId);
    }
}
</code></pre></div> </div>
        </div>
    </div>
</section>  
    <footer>
        <div class="container">
            <div class="row">
                <div class="col">
                    <div>
                        <div>
                            <img src="/img/logo-coding-club-linz-white.svg">
                        </div>
                        <div>Coding Club Linz<br />Birkenweg 16, 4060 Leonding <br />
                            <a href="mailto:info@linz.coderdojo.net">info@linz.coderdojo.net</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer> <!-- Js -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/locale/de-at.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
    <script src="https://linz.coderdojo.net/js/wow.min.js"></script>
    <script src="https://linz.coderdojo.net/js/main.js"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=6LfXNMcZAAAAALYnf3GpUqw5uotVMyjhLNU438i9"></script>
</body>

</html>
